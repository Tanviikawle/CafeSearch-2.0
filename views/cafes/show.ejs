<% layout('layouts/boilerplate') %>
<link rel="stylesheet" href="\stylesheets\stars.css">
<link rel="stylesheet" href="\stylesheets\map.css">

<script>
    const mapToken = '<%-process.env.LOCATIONIQ_KEY%>';
    const cafe = '<%-JSON.stringify(cafe)%>';
</script>

<div class="container" style="width: 180vh; margin-top: 10px;">
    <div class="row">
        <div class="col-6">
            <div class="mb-3">
                <h1 class="card-title" style="text-align: left;"><%= cafe.title %></h1>
            </div>
            <div class="mb-3">
                <h7>
                    <svg xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 384 512" style="fill: #ff0000;">
                        <path d="M215.7 499.2C267 435 384 279.4 384 192C384 86 298 0 192 0S0 86 0 192c0 87.4 117 243 168.3 307.2c12.3 15.3 35.1 15.3 47.4 0zM192 128a64 64 0 1 1 0 128 64 64 0 1 1 0-128z"/>
                    </svg>          
                    <%= cafe.location %>
                </h7>
            </div>
            <div class="mb-3">
                <p><%= cafe.seats%> seats</p>
            </div>
            <div class="mb-3 text-muted">
                <p>Submitted by: <%= cafe.author.username %></p>
            </div>
            <div class="mb-3">
                <h7><b>Description:</b></h7>
                <p class="card-text"><%= cafe.description %></p>
            </div>
            <div class="mb-3">
                <h7><b>Ameneties:</b></h7>
                <div class="amenities">
                    <% if(cafe.has_sockets==true){ %>
                    <div class="productivity">
                        <svg xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 384 512">
                            <style>svg{fill:#2C3639}</style><path d="M96 0C78.3 0 64 14.3 64 32v96h64V32c0-17.7-14.3-32-32-32zM288 0c-17.7 0-32 14.3-32 32v96h64V32c0-17.7-14.3-32-32-32zM32 160c-17.7 0-32 14.3-32 32s14.3 32 32 32v32c0 77.4 55 142 128 156.8V480c0 17.7 14.3 32 32 32s32-14.3 32-32V412.8C297 398 352 333.4 352 256V224c17.7 0 32-14.3 32-32s-14.3-32-32-32H32z"/>
                        </svg>
                        <p>Has sockets</p>
                    </div>
                    <% } %>
                    <% if(cafe.has_toilet==true){ %>
                    <div class="productivity">
                        <svg xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 448 512">
                            <style>svg{fill:#2C3639}</style><path d="M24 0C10.7 0 0 10.7 0 24S10.7 48 24 48h8V196.9c-1.9 1.4-3.8 2.9-5.6 4.4C10.9 214.5 0 232.9 0 256c0 46.9 14.3 84.1 37 112.5c14.2 17.7 31.1 31.3 48.5 41.8L65.6 469.9c-3.3 9.8-1.6 20.5 4.4 28.8s15.7 13.3 26 13.3H352c10.3 0 19.9-4.9 26-13.3s7.7-19.1 4.4-28.8l-19.8-59.5c17.4-10.5 34.3-24.1 48.5-41.8c22.7-28.4 37-65.5 37-112.5c0-23.1-10.9-41.5-26.4-54.6c-1.8-1.5-3.7-3-5.6-4.4V48h8c13.3 0 24-10.7 24-24s-10.7-24-24-24H24zM384 256.3c0 1-.3 2.6-3.8 5.6c-4.8 4.1-14 9-29.3 13.4C320.5 284 276.1 288 224 288s-96.5-4-126.9-12.8c-15.3-4.4-24.5-9.3-29.3-13.4c-3.5-3-3.8-4.6-3.8-5.6l0-.3 0-.1c0-1 0-2.5 3.8-5.8c4.8-4.1 14-9 29.3-13.4C127.5 228 171.9 224 224 224s96.5 4 126.9 12.8c15.3 4.4 24.5 9.3 29.3 13.4c3.8 3.2 3.8 4.8 3.8 5.8l0 .1 0 .3zM328.2 384l-.2 .5 0-.5h.2zM112 64h32c8.8 0 16 7.2 16 16s-7.2 16-16 16H112c-8.8 0-16-7.2-16-16s7.2-16 16-16z"/>
                        </svg>
                        <p>Has toilet</p>
                    </div>
                    <% } %>
                    <% if(cafe.has_wifi==true){ %>
                    <div class="productivity">
                        <svg xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 640 512">
                            <style>svg{fill:#2C3639}</style><path d="M54.2 202.9C123.2 136.7 216.8 96 320 96s196.8 40.7 265.8 106.9c12.8 12.2 33 11.8 45.2-.9s11.8-33-.9-45.2C549.7 79.5 440.4 32 320 32S90.3 79.5 9.8 156.7C-2.9 169-3.3 189.2 8.9 202s32.5 13.2 45.2 .9zM320 256c56.8 0 108.6 21.1 148.2 56c13.3 11.7 33.5 10.4 45.2-2.8s10.4-33.5-2.8-45.2C459.8 219.2 393 192 320 192s-139.8 27.2-190.5 72c-13.3 11.7-14.5 31.9-2.8 45.2s31.9 14.5 45.2 2.8c39.5-34.9 91.3-56 148.2-56zm64 160a64 64 0 1 0 -128 0 64 64 0 1 0 128 0z"/>
                        </svg>
                        <p>Has wifi</p>
                    </div>
                    <% } %>
                    <% if(cafe.can_take_calls==true){ %>
                    <div class="productivity">
                        <svg xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 512 512">
                            <style>svg{fill:#2C3639}</style><path d="M164.9 24.6c-7.7-18.6-28-28.5-47.4-23.2l-88 24C12.1 30.2 0 46 0 64C0 311.4 200.6 512 448 512c18 0 33.8-12.1 38.6-29.5l24-88c5.3-19.4-4.6-39.7-23.2-47.4l-96-40c-16.3-6.8-35.2-2.1-46.3 11.6L304.7 368C234.3 334.7 177.3 277.7 144 207.3L193.3 167c13.7-11.2 18.4-30 11.6-46.3l-40-96z"/>
                        </svg>
                        <p>Can take calls</p>
                    </div>  
                    <% } %>
                </div> 
            </div>
            <div class="mb-3" id="showButtons">
                <% if (currentUser && cafe.author.equals(currentUser._id)) { %>
                    <a href="<%= cafe._id %>/edit" class="card-link btn btn-primary">Edit</a>
                    <form class="d-inline" action="/cafes/<%=cafe._id%>?_method=DELETE" method="POST">
                        <button class="btn btn-danger">Delete</button>
                    </form>
                <% } %>
            </div>
            <div style="margin: 0px 3px;">
                <hr>
            </div>
        </div>
        <div class="col-6">
            <div class="mb-3" style="margin-top: 10px;">
                <div id="cafeCarousel" class="carousel slide mb-3 cafeImage">
                    <div class="carousel-inner cafeImage" >
                    <% cafe.images.forEach((img , i)=>{ %>
                      <div class="carousel-item <%= i === 0 ? 'active' : '' %> cafeImage" >
                        <img src="<%= img.url %>" class="cafeImage" alt=""  style=" width: 100%;">
                      </div>
                    <% }) %> 
                    </div>
                    <% if (cafe.images.length >1){ %>
                    <button class="carousel-control-prev" type="button" data-bs-target="#cafeCarousel" data-bs-slide="prev">
                      <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                      <span class="visually-hidden">Previous</span>
                    </button>
                    <button class="carousel-control-next" type="button" data-bs-target="#cafeCarousel" data-bs-slide="next">
                      <span class="carousel-control-next-icon" aria-hidden="true"></span>
                      <span class="visually-hidden">Next</span>
                    </button>
                    <% } %>
                </div>
            </div>
        </div>
    </div>
    <div class="container mb-3">
        <h3>Location</h3>
        <div class="container" style="padding: 0px;">
            <div id="showMap"></div>
        </div>
    </div>
<div class="container mb-3">
    <div class="row">
        <div class="col-6">
            <% for(let review of cafe.reviews) { %>
            <div class="mb-3">
                <h2>Reviews</h2>
            </div>
                <div class="card mb-3">
                    <div class="card-body">
                        <h5 class="card-title"><%= review.author.username %></h5>
                        <p class="starability-result" data-rating="<%= review.rating %>">
                            Rated: <%= review.rating %> stars 
                        </p>
                        <!-- <h6 class="card-subtitle text-muted">By <%= review.author.username %></h6> -->
                        <p class="card-text">Review: <%= review.body %></p>
                        <% if (currentUser && review.author.equals(currentUser._id)) { %>
                        <form action="/cafes/<%=cafe._id%>/reviews/<%=review._id%>?_method=DELETE" method="post">
                            <button class="btn btn-sm btn-danger">Delete</button>
                        </form>
                        <% } %>
                    </div>
                </div>
            <% } %>
        </div>
        <div class="col-6">
            <% if(currentUser) { %>
                <h2>Leave a review</h2>
                <form action="/cafes/<%=cafe._id%>/reviews" method="post" class="mb-3 validated-form">
                    <fieldset class="starability-basic">
                        <input type="radio" id="no-rate" class="input-no-rate" name="review[rating]" value="1" checked
                            aria-label="No rating." />
                        <input type="radio" id="first-rate1" name="review[rating]" value="1" />
                        <label for="first-rate1" title="Terrible">1 star</label>
                        <input type="radio" id="first-rate2" name="review[rating]" value="2" />
                        <label for="first-rate2" title="Not good">2 stars</label>
                        <input type="radio" id="first-rate3" name="review[rating]" value="3" />
                        <label for="first-rate3" title="Average">3 stars</label>
                        <input type="radio" id="first-rate4" name="review[rating]" value="4" />
                        <label for="first-rate4" title="Very good">4 stars</label>
                        <input type="radio" id="first-rate5" name="review[rating]" value="5" />
                        <label for="first-rate5" title="Amazing">5 stars</label>
                    </fieldset>
                    <div class="mb-3">
                        <label class="form-label" for="body">Review Text</label>
                        <textarea class="form-control" name="review[body]" id="body" cols="30" rows="3" required></textarea>
                        <div class="valid-feedback">
                            Looks good!
                        </div>
                    </div>
                    <button class="btn btn-success">Submit</button>
                </form>
                <% } %>
        </div>
    
        </div>
    </div>
</div>





<script src="/javascripts/showMap.js"></script>
